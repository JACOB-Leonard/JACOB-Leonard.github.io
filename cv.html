<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" itemscope itemtype="http://schema.org/WebPage">
<head>
    <title>Portfolio Multilingue</title>
    <link rel="alternate" hreflang="en" href="cv.html?lang=en" >
    <link rel="alternate" hreflang="fr" href="cv.html?lang=fr" >
    <link rel="alternate" hreflang="ja" href="cv.html?lang=jp" >
    <link rel="stylesheet" href="cv.css" >
    
</head>
<body>

    <nav>
        <ul>
            <li><a href="index.html" id="home-link">Accueil</a></li>
            <li><a href="cv.html" id="cv-link">Consulter le CV</a></li>
            <li id="lang-switcher">
                <img src="flags/fr.svg" alt="Français" class="flag" data-lang="fr">
                <img src="flags/en.svg" alt="English" class="flag" data-lang="en">
                <img src="flags/jp.svg" alt="日本語" class="flag" data-lang="jp">
            </li>
        </ul>
    </nav>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
    
            function getQueryParam(param) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }
    
            function getLanguage() {
                let lang = getQueryParam('lang');
                if (lang) return lang;
    
                lang = sessionStorage.getItem('lang');
                if (lang) return lang;
    
                lang = navigator.language.split('-')[0];
                if (['en', 'fr', 'jp'].includes(lang)) return lang;
    
                return 'en';
            }
    
            const lang = getLanguage();
            console.log(lang);
            sessionStorage.setItem('lang', lang);
            // URL du fichier XML et XSL
            const xmlFile = `xml/cv_${lang}.xml`;
            const xslFile = `xsl/cv_${lang}.xsl`;
    
            function transformXMLtoHTML(xmlString, xslString) {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlString, "text/xml");
                const xslDoc = parser.parseFromString(xslString, "text/xml");
    
                const xsltProcessor = new XSLTProcessor();
                xsltProcessor.importStylesheet(xslDoc);
    
                const resultFragment = xsltProcessor.transformToFragment(xmlDoc, document);
    
                const tempDiv = document.createElement('div');
                tempDiv.appendChild(resultFragment);
    
                return tempDiv.innerHTML;
            }
    
            // Charger le contenu des fichiers XML et XSL
            fetch(xmlFile)
                .then(response => response.text())
                .then(xmlString => {
                    fetch(xslFile)
                        .then(response => response.text())
                        .then(xslString => {
                            const transformedHTML = transformXMLtoHTML(xmlString, xslString);
                            document.body.innerHTML = transformedHTML;
                        })
                        .catch(error => console.error('Error loading XSL file:', error));
                })
                .catch(error => console.error('Error loading XML file:', error));
        
                document.getElementById('lang-switcher').addEventListener('click', function(event) {
                if (event.target.classList.contains('flag')) {
                    const selectedLang = event.target.dataset.lang;
                    window.history.pushState({}, '', `?lang=${selectedLang}`);
                    sessionStorage.setItem('lang', selectedLang);
                }
            });
        });
    </script>
</body>
</html>
